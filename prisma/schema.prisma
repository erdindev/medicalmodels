generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id               String         @id @default(cuid())
  name             String?
  email            String?        @unique
  emailVerified    DateTime?
  image            String?
  role             String         @default("user")
  plan             String         @default("free")
  stripeCustomerId String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  accounts         Account[]
  comparisons      Comparison[]
  uploadedModels   MedicalModel[]
  savedModels      SavedModel[]
  sessions         Session[]
}

model SavedModel {
  id        String   @id @default(cuid())
  userId    String
  modelId   String
  notes     String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, modelId])
  @@index([userId])
}

model Comparison {
  id         String   @id @default(cuid())
  userId     String
  name       String?
  modelIds   String
  isPublic   Boolean  @default(false)
  shareToken String?  @unique
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model MedicalModel {
  id             String          @id @default(cuid())
  slug           String          @unique
  name           String
  version        String
  description    String
  organizationId String?
  userId         String?
  specialtyId    String
  useCaseId      String
  downloads      Int             @default(0)
  likes          Int             @default(0)
  views          Int             @default(0)
  metadata       String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  publishedAt    DateTime?
  architecture   String?
  journal        String?
  benchmarks     Benchmark[]
  biasAnalyses   BiasAnalysis[]
  useCase        UseCase         @relation(fields: [useCaseId], references: [id])
  specialty      Specialty       @relation(fields: [specialtyId], references: [id])
  user           User?           @relation(fields: [userId], references: [id])
  organization   Organization?   @relation(fields: [organizationId], references: [id])
  metrics        ModelMetrics?
  tags           ModelTag[]
  practical      PracticalInfo?
  rocCurves      ROCCurve[]
  regulatory     RegulatoryInfo?
  training       TrainingInfo?
  validation     ValidationInfo?

  @@index([specialtyId])
  @@index([useCaseId])
  @@index([organizationId])
  @@index([userId])
}

model ModelMetrics {
  id                String       @id @default(cuid())
  modelId           String       @unique
  sensitivity       Float?
  specificity       Float?
  accuracy          Float?
  auc               Float?
  f1Score           Float?
  ppv               Float?
  npv               Float?
  sensitivityCI     String?
  specificityCI     String?
  aucCI             String?
  additionalMetrics String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  model             MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)
}

model ROCCurve {
  id            String       @id @default(cuid())
  modelId       String
  name          String
  dataPoints    String
  auc           Float?
  subgroupType  String?
  subgroupValue String?
  createdAt     DateTime     @default(now())
  model         MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([modelId])
}

model TrainingInfo {
  id                  String       @id @default(cuid())
  modelId             String       @unique
  datasetSize         Int?
  datasetSource       String?
  diversityScore      Float?
  diversityNotes      String?
  demographics        String?
  geographicCoverage  String?
  dataStartDate       DateTime?
  dataEndDate         DateTime?
  preprocessingSteps  String?
  augmentationUsed    Boolean      @default(false)
  augmentationDetails String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  model               MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)
}

model ValidationInfo {
  id                      String       @id @default(cuid())
  modelId                 String       @unique
  publicationCount        Int          @default(0)
  citationCount           Int          @default(0)
  clinicalTrialCount      Int          @default(0)
  clinicalTrialIds        String?
  validationType          String?
  externalValidation      Boolean      @default(false)
  externalValidationSites String?
  peerReviewed            Boolean      @default(false)
  publicationLinks        String?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  model                   MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)
}

model RegulatoryInfo {
  id                  String       @id @default(cuid())
  modelId             String       @unique
  fdaApproved         Boolean      @default(false)
  fdaClass            String?
  fda510kNumber       String?
  fdaApprovalDate     DateTime?
  ceMark              Boolean      @default(false)
  ceClass             String?
  ceApprovalDate      DateTime?
  gdprCompliant       Boolean      @default(false)
  hipaaCompliant      Boolean      @default(false)
  otherCertifications String?
  regulatoryDocuments String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  model               MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)
}

model PracticalInfo {
  id                   String       @id @default(cuid())
  modelId              String       @unique
  accessType           String
  licenseType          String?
  licenseUrl           String?
  costModel            String?
  costDetails          String?
  hardwareRequirements String?
  minGpuVram           Int?
  minRam               Int?
  supportedPlatforms   String?
  apiAvailable         Boolean      @default(false)
  apiDocumentationUrl  String?
  sdkLanguages         String?
  hasSupport           Boolean      @default(false)
  supportType          String?
  documentationUrl     String?
  repositoryUrl        String?
  demoUrl              String?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  model                MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)
}

model BiasAnalysis {
  id               String       @id @default(cuid())
  modelId          String
  biasType         String
  subgroupMetrics  String
  disparityScore   Float?
  assessmentMethod String?
  limitations      String?
  createdAt        DateTime     @default(now())
  model            MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([modelId])
}

model Organization {
  id          String         @id @default(cuid())
  name        String         @unique
  slug        String         @unique
  type        String?
  country     String?
  website     String?
  logoUrl     String?
  description String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  models      MedicalModel[]
}

model Specialty {
  id          String         @id @default(cuid())
  name        String         @unique
  slug        String         @unique
  description String?
  iconName    String?
  parentId    String?
  createdAt   DateTime       @default(now())
  models      MedicalModel[]
  parent      Specialty?     @relation("SpecialtyHierarchy", fields: [parentId], references: [id])
  children    Specialty[]    @relation("SpecialtyHierarchy")
}

model UseCase {
  id          String         @id @default(cuid())
  name        String         @unique
  slug        String         @unique
  description String?
  category    String?
  createdAt   DateTime       @default(now())
  models      MedicalModel[]
}

model Tag {
  id        String     @id @default(cuid())
  name      String     @unique
  slug      String     @unique
  category  String?
  createdAt DateTime   @default(now())
  models    ModelTag[]
}

model ModelTag {
  modelId String
  tagId   String
  tag     Tag          @relation(fields: [tagId], references: [id], onDelete: Cascade)
  model   MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@id([modelId, tagId])
}

model Benchmark {
  id             String       @id @default(cuid())
  modelId        String
  datasetName    String
  datasetVersion String?
  metrics        String
  rank           Int?
  totalModels    Int?
  evaluationDate DateTime?
  createdAt      DateTime     @default(now())
  model          MedicalModel @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([modelId])
}

model ScrapedPaper {
  id                  String   @id @default(cuid())
  pmid                String?  @unique
  pmcId               String?
  doi                 String?
  arxivId             String?  @unique
  title               String
  abstract            String
  authors             String
  journal             String?
  pubDate             String?
  specialty           String
  keywords            String?
  meshTerms           String?
  pubmedUrl           String?
  arxivUrl            String?
  pdfUrl              String?
  githubUrl           String?
  codeLinks           String?
  datasetUrl          String?
  demoUrl             String?
  hasModel            Boolean  @default(false)
  modelName           String?
  modelId             String?
  isProcessed         Boolean  @default(false)
  isReviewed          Boolean  @default(false)
  notes               String?
  reportedAuc         Float?
  reportedAccuracy    Float?
  reportedSensitivity Float?
  reportedSpecificity Float?
  datasetSize         Int?
  datasetName         String?
  citationCount       Int?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([specialty])
  @@index([hasModel])
  @@index([isProcessed])
}
